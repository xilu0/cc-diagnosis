# Claude Code è°ƒè¯•æŒ‡å—

[English](DEBUG.md) | ç®€ä½“ä¸­æ–‡

å…¨é¢çš„æŒ‡å—ï¼Œç”¨äºè¯Šæ–­å’Œæ’æŸ¥ Claude Code çš„æ€§èƒ½é—®é¢˜ã€æ— å“åº”å’Œå¡é¡¿è¿›ç¨‹ã€‚

## ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [è°ƒè¯•æ ‡å¿—å‚è€ƒ](#è°ƒè¯•æ ‡å¿—å‚è€ƒ)
- [æ—¥å¿—æ–‡ä»¶å’Œä½ç½®](#æ—¥å¿—æ–‡ä»¶å’Œä½ç½®)
- [å®æ—¶ç›‘æ§](#å®æ—¶ç›‘æ§)
- [æ•…éšœæ’æŸ¥å†³ç­–æ ‘](#æ•…éšœæ’æŸ¥å†³ç­–æ ‘)
- [å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ](#å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [ç¤¾åŒºå·¥å…·](#ç¤¾åŒºå·¥å…·)

---

## å¿«é€Ÿå¼€å§‹

å½“ Claude Code çœ‹èµ·æ¥å¡ä½æˆ–ç¼“æ…¢æ—¶,ç«‹å³è¿è¡Œï¼š

```bash
# å¯ç”¨æ‰€æœ‰è°ƒè¯•è¾“å‡º
claude --verbose --debug

# å¯¹äº MCP ç›¸å…³é—®é¢˜
claude --verbose --mcp-debug

# å°†è°ƒè¯•è¾“å‡ºä¿å­˜åˆ°æ–‡ä»¶
claude --verbose --debug > debug.log 2>&1
```

**å¿«é€Ÿè¯Šæ–­å‘½ä»¤ï¼š**

```bash
claude doctor          # ç³»ç»Ÿå¥åº·æ£€æŸ¥
claude /status         # æ£€æŸ¥å½“å‰çŠ¶æ€
claude mcp list        # MCP æœåŠ¡å™¨çŠ¶æ€
claude /cost           # æŸ¥çœ‹ä¼šè¯æˆæœ¬
```

---

## è°ƒè¯•æ ‡å¿—å‚è€ƒ

### `--verbose`

**ç”¨é€”**ï¼šæ˜¾ç¤ºå†…éƒ¨æ“ä½œçš„è¯¦ç»†è¯Šæ–­è¾“å‡º

**æ˜¾ç¤ºå†…å®¹ï¼š**
- æ¯ä¸ªæ“ä½œçš„æ—¶é—´æˆ³
- å·¥å…·æ‰§è¡Œå’Œå‚æ•°
- æ–‡ä»¶æ“ä½œï¼ˆè¯»å–ã€å†™å…¥ã€ç¼–è¾‘ï¼‰
- API é€šä¿¡è¯¦æƒ…
- æ“ä½œçŠ¶æ€å’Œç»“æœ

**ç”¨æ³•ï¼š**
```bash
claude --verbose
claude --verbose [command]
claude --verbose -p "ä½ çš„æç¤ºè¯"
```

**æœ€é€‚åˆï¼š**
- äº†è§£ Claude Code æ­£åœ¨åšä»€ä¹ˆ
- è¯†åˆ«ç“¶é¢ˆ
- è°ƒè¯•æ…¢å“åº”
- è·Ÿè¸ªå·¥å…·è°ƒç”¨

**ç¤ºä¾‹è¾“å‡ºï¼š**
```
[2025-01-14 10:30:45] API è¯·æ±‚: /v1/messages
[2025-01-14 10:30:46] å·¥å…·è°ƒç”¨: read_file(/path/to/file.js)
[2025-01-14 10:30:47] æ–‡ä»¶è¯»å–: 1234 å­—èŠ‚
[2025-01-14 10:30:48] API å“åº”: 200 OK (tokens: 1500)
```

### `--debug`

**ç”¨é€”**ï¼šå¯ç”¨å¸¦è¯¦ç»†è°ƒè¯•è¾“å‡ºçš„è°ƒè¯•æ¨¡å¼

**æ˜¾ç¤ºå†…å®¹ï¼š**
- å†…éƒ¨çŠ¶æ€ä¿¡æ¯
- é”™è¯¯å †æ ˆè·Ÿè¸ª
- é…ç½®å€¼
- ç¯å¢ƒå˜é‡

**ç”¨æ³•ï¼š**
```bash
claude --debug
claude --debug [command]
```

**æœ€é€‚åˆï¼š**
- æ’æŸ¥é”™è¯¯
- ç†è§£é…ç½®é—®é¢˜
- å¼€å‘è€…çº§åˆ«çš„è°ƒè¯•

### `--mcp-debug`

**ç”¨é€”**ï¼šä¸“é—¨ç”¨äº Model Context Protocol è¿æ¥çš„è°ƒè¯•

**æ˜¾ç¤ºå†…å®¹ï¼š**
- MCP æœåŠ¡å™¨åˆå§‹åŒ–
- è¿æ¥å°è¯•å’ŒçŠ¶æ€
- MCP æœåŠ¡å™¨çš„å·¥å…·å¯ç”¨æ€§
- MCP ç›¸å…³çš„é”™è¯¯å’Œè­¦å‘Š

**ç”¨æ³•ï¼š**
```bash
claude --mcp-debug
claude --verbose --mcp-debug  # æ¨èç»„åˆ
```

**æœ€é€‚åˆï¼š**
- MCP æœåŠ¡å™¨è¿æ¥é—®é¢˜
- ç¼ºå¤±æˆ–ä¸å¯ç”¨çš„ MCP å·¥å…·
- MCP é…ç½®é—®é¢˜

**æ£€æµ‹åˆ°çš„å¸¸è§é—®é¢˜ï¼š**
- MCP æœåŠ¡å™¨å¯åŠ¨å¤±è´¥
- ä»é¢„æœŸçš„ MCP æœåŠ¡å™¨æ‰¾ä¸åˆ°å·¥å…·
- MCP æœåŠ¡å™¨è¿æ¥è¶…æ—¶

### ç»„åˆä½¿ç”¨æ ‡å¿—

ä¸ºè·å¾—å…¨é¢çš„è¯Šæ–­ï¼Œç»„åˆä½¿ç”¨å¤šä¸ªæ ‡å¿—ï¼š

```bash
# æœ€å¤§è¯¦ç»†ç¨‹åº¦
claude --verbose --debug --mcp-debug

# å¤§å¤šæ•°è°ƒè¯•åœºæ™¯çš„æ¨èç»„åˆ
claude --verbose --mcp-debug
```

---

## æ—¥å¿—æ–‡ä»¶å’Œä½ç½®

### ä¸»è¦æ—¥å¿—ä½ç½®

Claude Code ä»¥ JSONLï¼ˆæ¢è¡Œåˆ†éš”çš„ JSONï¼‰æ ¼å¼å­˜å‚¨å®Œæ•´çš„ä¼šè¯æ—¥å¿—ï¼š

**è·¯å¾„ï¼š**
```bash
~/.claude/projects/<encoded-directory>/*.jsonl
```

**é…ç½®æ–‡ä»¶ï¼š**
```bash
~/.claude/settings.json              # å…¨å±€è®¾ç½®
.claude/settings.json                # é¡¹ç›®ç‰¹å®šè®¾ç½®
```

### æŸ¥æ‰¾ä½ çš„æ—¥å¿—

```bash
# æ–¹æ³• 1ï¼šä½¿ç”¨ doctor å‘½ä»¤
claude doctor
# è¾“å‡ºå°†æ˜¾ç¤ºï¼š"æ—¥å¿—ç›®å½•: /Users/username/.claude/projects/..."

# æ–¹æ³• 2ï¼šåˆ—å‡ºæœ€è¿‘çš„æ—¥å¿—
ls -lt ~/.claude/projects/*/
```

### æŸ¥çœ‹æ—¥å¿—

**åŸå§‹ JSONL æ ¼å¼ï¼š**
```bash
# æŸ¥çœ‹æœ€æ–°çš„æ—¥å¿—æ–‡ä»¶
tail -f ~/.claude/projects/*/$(ls -t ~/.claude/projects/*/ | head -1)

# ä½¿ç”¨ jq ç¾åŒ–è¾“å‡º
tail -f ~/.claude/projects/*/*.jsonl | jq '.'
```

**è¿‡æ»¤ç‰¹å®šäº‹ä»¶ï¼š**
```bash
# ä»…æ˜¾ç¤º API è¯·æ±‚
cat ~/.claude/projects/*/*.jsonl | jq 'select(.type == "api_request")'

# ä»…æ˜¾ç¤ºé”™è¯¯
cat ~/.claude/projects/*/*.jsonl | jq 'select(.level == "error")'

# æ˜¾ç¤ºå·¥å…·è°ƒç”¨
cat ~/.claude/projects/*/*.jsonl | jq 'select(.type == "tool_call")'
```

### æ—¥å¿—è½®æ¢å’Œæ¸…ç†

æ—¥å¿—å¯èƒ½ä¼šéšæ—¶é—´ç§¯ç´¯ã€‚ç®¡ç†ç©ºé—´çš„æ–¹æ³•ï¼š

```bash
# æ£€æŸ¥æ—¥å¿—ç›®å½•å¤§å°
du -sh ~/.claude/

# åˆ é™¤ 30 å¤©å‰çš„æ—¥å¿—
find ~/.claude/projects -name "*.jsonl" -mtime +30 -delete

# æ¯ä¸ªé¡¹ç›®ä»…ä¿ç•™æœ€è¿‘ 10 ä¸ªä¼šè¯
# ï¼ˆæ‰‹åŠ¨æ¸…ç† - åˆ é™¤å‰è¯·å…ˆæ£€æŸ¥ï¼‰
ls -t ~/.claude/projects/*/session*.jsonl | tail -n +11 | xargs rm
```

---

## å®æ—¶ç›‘æ§

### å†…ç½®ç›‘æ§å‘½ä»¤

åœ¨æ´»è·ƒçš„ Claude Code ä¼šè¯æœŸé—´ä½¿ç”¨è¿™äº›å‘½ä»¤ï¼š

```bash
/status              # å½“å‰ä¼šè¯çŠ¶æ€
/cost                # Token ä½¿ç”¨é‡å’Œæˆæœ¬
/permissions         # å½“å‰æƒé™è®¾ç½®
/clear               # æ¸…é™¤ä¸Šä¸‹æ–‡çª—å£
/compact             # å‹ç¼©å¯¹è¯å†å²
```

### åŸºäºç»ˆç«¯çš„ç›‘æ§

**å®æ—¶æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼š**
```bash
# åœ¨å•ç‹¬çš„ç»ˆç«¯çª—å£ä¸­
tail -f ~/.claude/projects/*/*.jsonl | jq -r '.timestamp + " " + .type + " " + (.message // "")'
```

**ç›‘æ§ API è°ƒç”¨ï¼š**
```bash
# è¿‡æ»¤ API é€šä¿¡
tail -f ~/.claude/projects/*/*.jsonl | jq 'select(.type | test("api"))'
```

**è·Ÿè¸ªå·¥å…·æ‰§è¡Œï¼š**
```bash
# ç›‘æ§å·¥å…·è°ƒç”¨
tail -f ~/.claude/projects/*/*.jsonl | jq 'select(.type == "tool_call") | {time: .timestamp, tool: .tool_name, duration: .duration}'
```

### ç¤¾åŒºç›‘æ§å·¥å…·

#### 1. claude-code-loggerï¼ˆåŸºäºä»£ç†ï¼‰

æ‹¦æˆªå¹¶æ˜¾ç¤º Claude Code å’Œ API ä¹‹é—´çš„æµé‡ã€‚

**å®‰è£…ï¼š**
```bash
git clone https://github.com/username/claude-code-logger
cd claude-code-logger
npm install
npm run dev -- start --chat-mode
```

**ä½¿ç”¨ï¼š**
```bash
# ç»ˆç«¯ 1ï¼šå¯åŠ¨ä»£ç†
npm run dev -- start --chat-mode

# ç»ˆç«¯ 2ï¼šä½¿ç”¨ä»£ç†è¿è¡Œ Claude
ANTHROPIC_BASE_URL=http://localhost:8000/ claude
```

**åŠŸèƒ½ï¼š**
- å®æ—¶è¯·æ±‚/å“åº”æµå¼ä¼ è¾“
- å¸¦å½©è‰²è¾“å‡ºçš„èŠå¤©æ¨¡å¼
- è¯·æ±‚/å“åº”æ ¼å¼åŒ–
- å»¶è¿Ÿè·Ÿè¸ª

#### 2. claude-code-logï¼ˆTUI æŸ¥çœ‹å™¨ï¼‰

ç”¨äºæµè§ˆä¼šè¯çš„äº¤äº’å¼ç»ˆç«¯ UIã€‚

**å®‰è£…ï¼š**
```bash
pipx install claude-conversation-extractor
# æˆ–
pip install claude-conversation-extractor
```

**ä½¿ç”¨ï¼š**
```bash
# äº¤äº’å¼ TUI
claude-code-log --tui

# å¯åŠ¨ä¼šè¯æµè§ˆå™¨
claude-start
```

**åŠŸèƒ½ï¼š**
- å¸¦ IDã€æ‘˜è¦ã€æ—¶é—´æˆ³çš„ä¼šè¯åˆ—è¡¨
- æ¶ˆæ¯è®¡æ•°å’Œ Token ä½¿ç”¨é‡
- æœç´¢å’Œè¿‡æ»¤åŠŸèƒ½
- å¯¼å‡ºå¯¹è¯

#### 3. å®æ—¶ä»ªè¡¨æ¿ï¼ˆè‡ªå®šä¹‰è„šæœ¬ï¼‰

åˆ›å»ºä¸€ä¸ªç®€å•çš„ç›‘æ§è„šæœ¬ï¼š

```bash
#!/bin/bash
# ä¿å­˜ä¸º monitor-claude.sh

LOG_DIR="$HOME/.claude/projects"
LATEST_LOG=$(find "$LOG_DIR" -name "*.jsonl" -type f -printf '%T@ %p\n' | sort -n | tail -1 | cut -f2- -d" ")

echo "ç›‘æ§ä¸­: $LATEST_LOG"
echo "æŒ‰ Ctrl+C åœæ­¢"
echo ""

tail -f "$LATEST_LOG" | while read line; do
    TYPE=$(echo "$line" | jq -r '.type // "unknown"')
    TIMESTAMP=$(echo "$line" | jq -r '.timestamp // "no-time"')

    case "$TYPE" in
        "api_request")
            echo "[$TIMESTAMP] ğŸŒ API è¯·æ±‚"
            ;;
        "api_response")
            TOKENS=$(echo "$line" | jq -r '.usage.total_tokens // "?"')
            echo "[$TIMESTAMP] âœ… API å“åº” (tokens: $TOKENS)"
            ;;
        "tool_call")
            TOOL=$(echo "$line" | jq -r '.tool_name // "unknown"')
            echo "[$TIMESTAMP] ğŸ”§ å·¥å…·: $TOOL"
            ;;
        "error")
            MSG=$(echo "$line" | jq -r '.message // "unknown error"')
            echo "[$TIMESTAMP] âŒ é”™è¯¯: $MSG"
            ;;
    esac
done
```

æ·»åŠ æ‰§è¡Œæƒé™å¹¶è¿è¡Œï¼š
```bash
chmod +x monitor-claude.sh
./monitor-claude.sh
```

---

## æ•…éšœæ’æŸ¥å†³ç­–æ ‘

### å½“ Claude Code çœ‹èµ·æ¥å¡ä½æ—¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Claude Code çœ‹èµ·æ¥æ— å“åº”           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¯ç”¨: claude --verbose --debug     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è§‚å¯Ÿè¾“å‡º 30-60 ç§’                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚
        â–¼             â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ æœ‰è¾“å‡ºï¼Ÿâ”‚   â”‚ æ— è¾“å‡ºï¼Ÿâ”‚
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
       â”‚             â”‚
       â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                           â”‚
       â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä»€ä¹ˆç±»å‹çš„       â”‚    â”‚ æ£€æŸ¥æ—¥å¿—æ–‡ä»¶:        â”‚
â”‚ è¾“å‡ºï¼Ÿ           â”‚    â”‚ tail -f ~/.claude/   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚      projects/*/*.jsonlâ”‚
     â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                             â”‚
     â”œâ”€ API è¯·æ±‚/å“åº”              â”œâ”€ æ–‡ä»¶åœ¨å¢é•¿ï¼Ÿ
     â”‚  â†’ æ­£å¸¸å¤„ç†ä¸­               â”‚  æ˜¯ â†’ åå°å¤„ç†ä¸­
     â”‚  â†’ ç»§ç»­ç­‰å¾…                 â”‚  å¦ â†’ è¿›ç¨‹æŒ‚èµ·
     â”‚                             â”‚       â†’ Ctrl+C é‡è¯•
     â”œâ”€ å·¥å…·è°ƒç”¨
     â”‚  â†’ æ£€æŸ¥æ˜¯å¦å¾ªç¯
     â”‚  â†’ å¦‚æœå¡ä½ï¼ŒCtrl+C
     â”‚  â†’ å¦‚æœæ˜¯ MCP å·¥å…·ï¼Œæ£€æŸ¥ï¼š
     â”‚     claude mcp list
     â”‚
     â”œâ”€ é”™è¯¯æ¶ˆæ¯
     â”‚  â†’ å¤„ç†ç‰¹å®šé”™è¯¯
     â”‚  â†’ å‚è§ä¸‹é¢çš„å¸¸è§é—®é¢˜
     â”‚
     â””â”€ è¶…æ—¶è­¦å‘Š
        â†’ ç½‘ç»œé—®é¢˜
        â†’ æ£€æŸ¥è¿æ¥æ€§
        â†’ è¿è¡Œç½‘ç»œè¯Šæ–­
```

### å¿«é€Ÿå†³ç­–ç‚¹

| ç—‡çŠ¶ | æ£€æŸ¥è¿™ä¸ª | è¡ŒåŠ¨ |
|------|---------|------|
| 2 åˆ†é’Ÿä»¥ä¸Šæ— è¾“å‡º | æ—¥å¿—æ–‡ä»¶è¿˜åœ¨å¢é•¿ï¼Ÿ | æ˜¯ï¼šç­‰å¾…ï¼›å¦ï¼šCtrl+C é‡è¯• |
| é‡å¤çš„å·¥å…·è°ƒç”¨ | åŒä¸€å·¥å…·è¢«è°ƒç”¨ 10 æ¬¡ä»¥ä¸Šï¼Ÿ | å¯èƒ½æ˜¯å¾ªç¯ï¼ŒæŒ‰ Ctrl+C |
| API è¶…æ—¶ | ç½‘ç»œè¿æ¥æ€§ | è¿è¡Œ `./diagnose.sh` è¿›è¡Œç½‘ç»œæ£€æŸ¥ |
| MCP é”™è¯¯ | `claude mcp list` | é‡å¯å—å½±å“çš„ MCP æœåŠ¡å™¨ |
| é«˜å†…å­˜ä½¿ç”¨ | ä¸Šä¸‹æ–‡çª—å£å¤§å° | è¿è¡Œ `/clear` æˆ– `/compact` |
| å“åº”ç¼“æ…¢ | Token è®¡æ•° | æ£€æŸ¥ `/cost`ï¼Œè€ƒè™‘ `/clear` |

---

## å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1ï¼šClaude Code çœ‹èµ·æ¥å†»ç»“

**ç—‡çŠ¶ï¼š**
- æ²¡æœ‰å¯è§çš„è¿›å±•
- æ²¡æœ‰ç»ˆç«¯è¾“å‡º
- å…‰æ ‡åªæ˜¯é—ªçƒ

**è¯Šæ–­ï¼š**
```bash
# ç»ˆç«¯ 1ï¼šä½¿ç”¨ verbose è¿è¡Œ
claude --verbose

# ç»ˆç«¯ 2ï¼šç›‘æ§æ—¥å¿—
tail -f ~/.claude/projects/*/*.jsonl | jq -r '.timestamp + " " + .type'
```

**è§£å†³æ–¹æ¡ˆï¼š**

**å¦‚æœæ—¥å¿—æ˜¾ç¤ºæ´»åŠ¨ï¼š**
- Claude æ­£åœ¨å·¥ä½œï¼Œè¯·è€å¿ƒç­‰å¾…
- å¤§æ–‡ä»¶æ“ä½œéœ€è¦æ—¶é—´
- å¤æ‚çš„æ¨ç†éœ€è¦å¤„ç†

**å¦‚æœæ—¥å¿—æ˜¯é™æ€çš„ï¼š**
```bash
# æŒ‰ Ctrl+C ä¸­æ–­
# ç„¶åæ¸…é™¤ä¸Šä¸‹æ–‡åé‡è¯•
claude
/clear
# é‡è¯•ä½ çš„è¯·æ±‚
```

### é—®é¢˜ 2ï¼šå“åº”æ—¶é—´æ…¢

**ç—‡çŠ¶ï¼š**
- æ¯ä¸ªå“åº”éœ€è¦ 30 ç§’ä»¥ä¸Š
- æ€è€ƒä¼¼ä¹å¾ˆæ…¢
- å·¥å…·è°ƒç”¨è¢«å»¶è¿Ÿ

**è¯Šæ–­ï¼š**
```bash
# æ£€æŸ¥ä¸Šä¸‹æ–‡å¤§å°
/cost  # æ˜¾ç¤ºä½¿ç”¨çš„ tokens

# æ£€æŸ¥ä¸Šä¸‹æ–‡è†¨èƒ€
/status
```

**è§£å†³æ–¹æ¡ˆï¼š**

1. **å®šæœŸæ¸…é™¤ä¸Šä¸‹æ–‡ï¼š**
```bash
/clear     # å®Œå…¨é‡ç½®ä¸Šä¸‹æ–‡
/compact   # å‹ç¼©å†å²è®°å½•åŒæ—¶ä¿æŒä¸Šä¸‹æ–‡
```

2. **ä¼˜åŒ–æç¤ºè¯ï¼š**
```bash
# ä¸å¥½ï¼šæ¨¡ç³Šä¸”éœ€è¦æ¢ç´¢
"ä¿®å¤æ‰€æœ‰ bug"

# å¥½ï¼šå…·ä½“ä¸”æœ‰é’ˆå¯¹æ€§
"ä¿®å¤ src/utils/parser.js ç¬¬ 45 è¡Œçš„ TypeError"
```

3. **ä½¿ç”¨ CLAUDE.md æä¾›ä¸Šä¸‹æ–‡ï¼š**

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.claude/CLAUDE.md`ï¼š
```markdown
# é¡¹ç›®ï¼šMyApp

## ç»“æ„
- src/ - æºä»£ç 
- tests/ - æµ‹è¯•æ–‡ä»¶
- docs/ - æ–‡æ¡£

## å¸¸ç”¨å‘½ä»¤
- npm test - è¿è¡Œæµ‹è¯•
- npm build - æ„å»ºé¡¹ç›®

## ä»£ç é£æ ¼
- ä½¿ç”¨ TypeScript
- åå¥½å‡½æ•°å¼é£æ ¼
- æœ€å¤§è¡Œé•¿åº¦ï¼š100

## å·²çŸ¥é—®é¢˜
- API é€Ÿç‡é™åˆ¶ï¼š100 è¯·æ±‚/åˆ†é’Ÿ
- æ•°æ®åº“ï¼šPostgreSQL 14+
```

### é—®é¢˜ 3ï¼šMCP æœåŠ¡å™¨ä¸å·¥ä½œ

**ç—‡çŠ¶ï¼š**
- å·¥å…·ä¸å¯ç”¨
- MCP è¿æ¥é”™è¯¯
- "æœåŠ¡å™¨æ— å“åº”"

**è¯Šæ–­ï¼š**
```bash
# æ£€æŸ¥ MCP æœåŠ¡å™¨çŠ¶æ€
claude mcp list
claude --mcp-debug
```

**é¢„æœŸè¾“å‡ºï¼š**
```
âœ“ github - å·²è¿æ¥ï¼ˆ15 ä¸ªå·¥å…·å¯ç”¨ï¼‰
âœ“ filesystem - å·²è¿æ¥ï¼ˆ8 ä¸ªå·¥å…·å¯ç”¨ï¼‰
âœ— custom-server - è¿æ¥å¤±è´¥
```

**è§£å†³æ–¹æ¡ˆï¼š**

1. **é‡å¯å•ä¸ª MCP æœåŠ¡å™¨ï¼š**
```bash
# æ£€æŸ¥ MCP é…ç½®
cat ~/.claude/mcp-servers.json

# æ‰‹åŠ¨æµ‹è¯•æœåŠ¡å™¨
node /path/to/mcp-server/index.js
```

2. **æ£€æŸ¥ MCP æœåŠ¡å™¨æ—¥å¿—ï¼š**
```bash
# MCP æœåŠ¡å™¨é€šå¸¸è®°å½•åˆ° stderr
# æ£€æŸ¥ Claude Code æ—¥å¿—ä¸­çš„ MCP é”™è¯¯
cat ~/.claude/projects/*/*.jsonl | jq 'select(.type == "mcp_error")'
```

3. **éªŒè¯ MCP é…ç½®ï¼š**
```json
// ~/.claude/mcp-servers.json
{
  "mcpServers": {
    "filesystem": {
      "command": "node",
      "args": ["/path/to/filesystem-server/index.js"]
    }
  }
}
```

### é—®é¢˜ 4ï¼šå†…å­˜ä¸è¶³é”™è¯¯

**ç—‡çŠ¶ï¼š**
- è¿›ç¨‹å´©æºƒ
- "JavaScript heap out of memory"
- ç³»ç»Ÿå˜æ…¢

**è¯Šæ–­ï¼š**
```bash
# æ£€æŸ¥ Node.js å†…å­˜ä½¿ç”¨
ps aux | grep claude

# åœ¨æ‰§è¡ŒæœŸé—´ç›‘æ§å†…å­˜
while true; do
  ps aux | grep claude | grep -v grep | awk '{print $6/1024 " MB"}'
  sleep 2
done
```

**è§£å†³æ–¹æ¡ˆï¼š**

1. **å¢åŠ  Node.js å†…å­˜ï¼š**
```bash
# è®¾ç½®å†…å­˜é™åˆ¶ï¼ˆ8GB ç¤ºä¾‹ï¼‰
export NODE_OPTIONS="--max-old-space-size=8192"
claude
```

2. **é¢‘ç¹æ¸…é™¤ä¸Šä¸‹æ–‡ï¼š**
```bash
# æ¯å®Œæˆä¸€ä¸ªä¸»è¦ä»»åŠ¡åä½¿ç”¨ /clear
/clear
```

3. **é¿å…åŠ è½½å¤§æ–‡ä»¶ï¼š**
```bash
# ä¸å¥½ï¼šåŠ è½½æ•´ä¸ª 50MB æ—¥å¿—æ–‡ä»¶
# å¥½ï¼šè®© Claude è¯»å–ç‰¹å®šè¡Œæˆ–å…ˆä½¿ç”¨ grep
```

### é—®é¢˜ 5ï¼šToken é™åˆ¶è¶…å‡º

**ç—‡çŠ¶ï¼š**
- "ä¸Šä¸‹æ–‡çª—å£è¶…å‡º"
- "è¾¾åˆ°æœ€å¤§ tokens"
- å“åº”è¢«æˆªæ–­

**è¯Šæ–­ï¼š**
```bash
/cost   # æ£€æŸ¥å½“å‰ token ä½¿ç”¨é‡
```

**è§£å†³æ–¹æ¡ˆï¼š**

1. **ä½¿ç”¨ /compact è€Œä¸æ˜¯ /clearï¼š**
```bash
/compact  # ä¿ç•™é‡è¦ä¸Šä¸‹æ–‡ï¼Œåˆ é™¤å†—ä½™å†…å®¹
```

2. **åˆ†è§£ä»»åŠ¡ï¼š**
```bash
# ä¸è¦è¿™æ ·ï¼š"é‡æ„æ•´ä¸ªä»£ç åº“"
# è€Œæ˜¯è¿™æ ·ï¼š"é‡æ„ src/auth.js"ï¼Œç„¶å "é‡æ„ src/api.js"ï¼Œç­‰ç­‰
```

3. **ä½¿ç”¨é€‰æ‹©æ€§æ–‡ä»¶è¯»å–ï¼š**
```bash
# å¼•å¯¼ Claude åªè¯»å–ç›¸å…³æ–‡ä»¶
"åªè¯»å– src/ ä¸­ä¸èº«ä»½éªŒè¯ç›¸å…³çš„æ–‡ä»¶"
```

---

## æ€§èƒ½ä¼˜åŒ–

### æœ€ä½³å®è·µ

#### 1. ä¸Šä¸‹æ–‡ç®¡ç†

```bash
# å·¥ä½œä¼šè¯å¼€å§‹
claude

# å®Œæˆä¸»è¦ä»»åŠ¡å
/clear

# åˆ‡æ¢åˆ°ä¸åŒä»»åŠ¡å‰
/compact
```

#### 2. æœ‰æ•ˆçš„æç¤º

**ä¸å¥½çš„æç¤ºï¼ˆæ…¢ï¼Œèµ„æºå¯†é›†ï¼‰ï¼š**
- "ä¿®å¤æ‰€æœ‰é—®é¢˜"
- "è®©è¿™ä¸ªæ›´å¥½"
- "å®¡æŸ¥æ‰€æœ‰å†…å®¹"

**å¥½çš„æç¤ºï¼ˆå¿«ï¼Œæœ‰é’ˆå¯¹æ€§ï¼‰ï¼š**
- "ä¿®å¤ auth.js:42 çš„ç©ºæŒ‡é’ˆé”™è¯¯"
- "ä¸ºç™»å½•å‡½æ•°æ·»åŠ é”™è¯¯å¤„ç†"
- "å®¡æŸ¥å¯†ç é‡ç½®æµç¨‹çš„å®‰å…¨æ€§"

#### 3. CLAUDE.md é…ç½®

ä¸º Claude åˆ›å»ºæœ‰ç”¨çš„ä¸Šä¸‹æ–‡ï¼š

```markdown
# é¡¹ç›®é…ç½®

## å¿«é€Ÿäº‹å®
- è¯­è¨€ï¼šTypeScript
- æ¡†æ¶ï¼šReact + Express
- æ•°æ®åº“ï¼šPostgreSQL
- æµ‹è¯•ï¼šJest

## æ–‡ä»¶ç»“æ„
```
src/
â”œâ”€â”€ api/       # REST API ç«¯ç‚¹
â”œâ”€â”€ components/  # React ç»„ä»¶
â”œâ”€â”€ utils/     # è¾…åŠ©å‡½æ•°
â””â”€â”€ types/     # TypeScript ç±»å‹
```

## å¸¸ç”¨å‘½ä»¤
- `npm test` - è¿è¡Œæ‰€æœ‰æµ‹è¯•
- `npm run dev` - å¯åŠ¨å¼€å‘æœåŠ¡å™¨
- `npm run build` - ç”Ÿäº§æ„å»º

## ç¼–ç æ ‡å‡†
- æœ€å¤§å‡½æ•°é•¿åº¦ï¼š50 è¡Œ
- ä¼˜å…ˆä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿
- æ‰€æœ‰å¯¼å‡ºå¿…é¡»æœ‰ JSDoc æ³¨é‡Š

## è°ƒè¯•è¯´æ˜
- API æœåŠ¡å™¨è¿è¡Œåœ¨ 3000 ç«¯å£
- æ•°æ®åº“è¿æ¥ï¼šlocalhost:5432
- Redis ç¼“å­˜ï¼šlocalhost:6379
```

#### 4. é™åˆ¶å·¥å…·æ‰§è¡Œ

```bash
# ä½¿ç”¨ --max-turns é˜²æ­¢å¤±æ§æ‰§è¡Œ
claude --max-turns 5 -p "ä½ çš„å¤æ‚ä»»åŠ¡"
```

#### 5. ç›‘æ§èµ„æºä½¿ç”¨

```bash
# åˆ›å»ºç›‘æ§åˆ«å
alias claude-monitor='watch -n 1 "ps aux | grep claude | grep -v grep"'

# åœ¨å¼€å§‹å¯†é›†å·¥ä½œå‰è¿è¡Œ
claude-monitor
```

### é…ç½®ä¼˜åŒ–

**å…¨å±€è®¾ç½®ï¼ˆ`~/.claude/settings.json`ï¼‰ï¼š**

```json
{
  "verbose": false,
  "auto_clear_context": true,
  "max_context_tokens": 100000,
  "tool_timeout": 30000
}
```

**é¡¹ç›®è®¾ç½®ï¼ˆ`.claude/settings.json`ï¼‰ï¼š**

```json
{
  "ignored_paths": [
    "node_modules/",
    "dist/",
    "build/",
    "*.log",
    ".git/"
  ],
  "max_file_size": 1048576
}
```

---

## ç¤¾åŒºå·¥å…·

### 1. claude-code-logger

**ç”¨é€”**ï¼šHTTP ä»£ç†ç›‘æ§ API æµé‡

**å®‰è£…ï¼š**
```bash
git clone https://github.com/anthropics/claude-code-logger
cd claude-code-logger
npm install
```

**ä½¿ç”¨ï¼š**
```bash
npm run dev -- start --chat-mode
ANTHROPIC_BASE_URL=http://localhost:8000/ claude
```

**åŠŸèƒ½ï¼š**
- å®æ—¶è¯·æ±‚/å“åº”æ˜¾ç¤º
- Token è®¡æ•°
- å»¶è¿Ÿæµ‹é‡
- èŠå¤©å¼æ ¼å¼åŒ–

### 2. claude-conversation-extractor

**ç”¨é€”**ï¼šæå–å’Œæµè§ˆ Claude Code ä¼šè¯

**å®‰è£…ï¼š**
```bash
pipx install claude-conversation-extractor
```

**ä½¿ç”¨ï¼š**
```bash
# äº¤äº’å¼ TUI
claude-code-log --tui

# å¯¼å‡ºç‰¹å®šå¯¹è¯
claude-code-log export --id <session-id> --format markdown
```

**åŠŸèƒ½ï¼š**
- ä¼šè¯æœç´¢
- Token ç»Ÿè®¡
- å¯¼å‡ºä¸ºå¤šç§æ ¼å¼
- å¯¹è¯å›æ”¾

### 3. è‡ªå®šä¹‰ç›‘æ§è„šæœ¬

**å®æ—¶ token è®¡æ•°å™¨ï¼š**
```bash
#!/bin/bash
# live-cost.sh

while true; do
  LOG=$(find ~/.claude/projects -name "*.jsonl" -type f -printf '%T@ %p\n' | sort -n | tail -1 | cut -f2- -d" ")
  TOKENS=$(tail -1000 "$LOG" | jq -s '[.[].usage.total_tokens // 0] | add')
  echo "æœ€è¿‘ 1000 ä¸ªäº‹ä»¶çš„æ€» tokens: $TOKENS"
  sleep 5
done
```

**é”™è¯¯è·Ÿè¸ªå™¨ï¼š**
```bash
#!/bin/bash
# track-errors.sh

LOG_DIR="$HOME/.claude/projects"

echo "ç›‘æ§é”™è¯¯ä¸­..."
tail -f "$LOG_DIR"/*/*.jsonl | jq -r 'select(.level == "error") | .timestamp + " é”™è¯¯: " + .message'
```

---

## é™„å½•ï¼šè°ƒè¯•æ£€æŸ¥æ¸…å•

åœ¨æ•…éšœæ’æŸ¥æ—¶ï¼ŒæŒ‰ç…§è¿™ä¸ªæ£€æŸ¥æ¸…å•é€é¡¹æ£€æŸ¥ï¼š

- [ ] å·²å¯ç”¨ `--verbose` æ ‡å¿—
- [ ] å·²æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æ­£åœ¨è¢«å†™å…¥
- [ ] å·²éªŒè¯ç½‘ç»œè¿æ¥ï¼ˆè¿è¡Œ `./diagnose.sh`ï¼‰
- [ ] å·²ç¡®è®¤ MCP æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼ˆ`claude mcp list`ï¼‰
- [ ] å·²æ£€æŸ¥ä¸Šä¸‹æ–‡å¤§å°ï¼ˆ`/cost`ï¼‰
- [ ] å¦‚éœ€è¦å·²æ¸…é™¤ä¸Šä¸‹æ–‡ï¼ˆ`/clear`ï¼‰
- [ ] å·²æŸ¥çœ‹æ—¥å¿—ä¸­çš„æœ€è¿‘é”™è¯¯
- [ ] å·²éªŒè¯ç£ç›˜ç©ºé—´å¯ç”¨
- [ ] å·²æ£€æŸ¥ç³»ç»Ÿå†…å­˜ä½¿ç”¨
- [ ] å·²ç”¨æœ€å°æç¤ºæµ‹è¯•
- [ ] å·²æŸ¥çœ‹ CLAUDE.md é…ç½®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- [ ] å·²ç¡®è®¤ API å¯†é’¥æœ‰æ•ˆ

---

## è·å–å¸®åŠ©

å¦‚æœæŒ‰ç…§æœ¬æŒ‡å—æ“ä½œåé—®é¢˜ä»ç„¶å­˜åœ¨ï¼š

1. **æ”¶é›†è°ƒè¯•ä¿¡æ¯ï¼š**
```bash
# ç”Ÿæˆç»¼åˆè°ƒè¯•æŠ¥å‘Š
claude doctor > claude-debug-report.txt
claude --verbose --debug [your-command] >> claude-debug-report.txt 2>&1
```

2. **æŸ¥çœ‹ç¤¾åŒºèµ„æºï¼š**
- GitHub Issuesï¼šhttps://github.com/anthropics/claude-code/issues
- Discordï¼šClaude Code ç¤¾åŒºé¢‘é“
- æ–‡æ¡£ï¼šhttps://docs.anthropic.com

3. **æäº¤ bug æŠ¥å‘Šæ—¶é™„ä¸Šï¼š**
- è°ƒè¯•æŠ¥å‘Šè¾“å‡º
- ç›¸å…³æ—¥å¿—æ‘˜å½•
- å¤ç°æ­¥éª¤
- ç³»ç»Ÿä¿¡æ¯ï¼ˆæ“ä½œç³»ç»Ÿã€Node ç‰ˆæœ¬ã€Claude Code ç‰ˆæœ¬ï¼‰

---

**æœ€åæ›´æ–°**ï¼š2025-01-14

å…³äºç½‘ç»œè¿æ¥é—®é¢˜ï¼Œè¯·å‚é˜… [README_CN.md](README_CN.md) å¹¶ä½¿ç”¨è¯Šæ–­è„šæœ¬ï¼ˆ`diagnose.sh` æˆ– `diagnose.ps1`ï¼‰ã€‚
